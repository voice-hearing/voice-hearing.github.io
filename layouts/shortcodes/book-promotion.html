{{/* 
Book Promotion Shortcode - Complete corrected version
- Prize moved under rating stars
- Print length & publication date moved before buttons  
- Rounded-full buttons with play icons
- Dark mode button visibility
- Single text-link overlay on image
*/}}

{{ $page := .Page }}
{{ $title := (.Get "title") | emojify | $page.RenderString }}
{{ $blue := (.Get "blue") | emojify | $page.RenderString }}
{{ $items := index site.Data (.Get "items" | default "books") }}

<style>
.text-sm {
  font-size: 1.25rem !important;
}
.text-base {
  font-size: 1.5rem !important;
  text-transform: none !important; 
}
</style>


<section>
  {{ with $blue }}
  <p class="mb-2 text-lg md:text-xl tracking-tight uppercase font-semibold text-primary-600 dark:text-primary-300 text-center">{{ . }}</p>
  {{ end }}

  {{ with $title }}
  <h2 class="mb-8 text-3xl font-bold text-center text-gray-900 dark:text-white">{{ . }}</h2>
  {{ end }}

  {{ range $items }}
  <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center mb-12">

    <!-- LEFT: Book details -->
    <div class="flex flex-col items-start px-6">
      <h2 class="text-base font-semibold leading-tight text-gray-900 dark:text-white">{{ .title }}</h2>
      <a href="{{ .author_url }}" class="hover:underline">
      <h3 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1">{{ .author }} (Author)</h3>
      </a>
      <!-- Rating stars -->
      {{ $rating := float .rating }}
      {{ $intPart := int $rating }}
      {{ $hasHalf := gt (mod (mul $rating 10) 10) 0 }}
      <div class="flex items-center mb-1">
        {{ range seq $intPart }}
          <svg class="w-5 h-5 text-yellow-400 fill-current" viewBox="0 0 24 24">
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
          </svg>
        {{ end }}
        {{ if $hasHalf }}
          <svg class="w-5 h-5 text-yellow-400 fill-current" viewBox="0 0 24 24">
            <defs>
              <linearGradient id="half">
                <stop offset="50%" stop-color="currentColor"/>
                <stop offset="50%" stop-color="transparent"/>
              </linearGradient>
            </defs>
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" fill="url(#half)"/>
          </svg>
        {{ end }}
        <span class="ml-2 text-sm font-medium text-gray-700 dark:text-gray-300">{{ printf "%.1f" $rating }}</span>
      </div>

      <!-- Prize - moved under rating -->
      <p class="mb-4 text-xs text-gray-900 dark:text-white">Winner of: {{ .prize }}</p>

      <!-- Synopsis -->
      <p class="mb-4 text-sm text-gray-800 dark:text-gray-300">"{{ .synopsis }}"</p>

      <!-- Print length & publication date - moved before buttons -->
      <p class="mb-4 text-xs text-gray-600 dark:text-gray-400">
        Page Number: {{ .pages }} pages &#8226; Publication date: {{ .pub_date }} &#8226; File size: {{ .file_size }}
      </p>

      <!-- Buttons - rounded-full with play icons -->
      <div class="mt-6 inline-flex space-x-3">
        <a href="{{ .ebook_url }}" 
           class="flex items-center gap-2 rounded-full px-4 py-2 border border-gray-300 
                  bg-white text-gray-900 hover:bg-gray-50 
                  dark:border-gray-600 dark:bg-primary-700 dark:text-white dark:hover:bg-primary-800 
                  transition">
          E-book
        </a>

        <a href="{{ .audiobook_url }}" 
           class="flex items-center gap-2 rounded-full px-4 py-2 border border-gray-300 
                  bg-white text-gray-900 hover:bg-gray-50 
                  dark:border-gray-600 dark:bg-primary-700 dark:text-white dark:hover:bg-primary-800 
                  transition">
          Audiobook
        </a>
      </div>
    </div>

    <!-- RIGHT: Cover with overlay -->
    <div class="relative flex justify-center items-center px-6">
      {{ $book := . }}
      {{ $img := resources.GetMatch (path.Join "media" $book.image) }}
      {{ with $img }}
      {{ $resized := .Fit "300x450 center webp" }}
      <div class="relative">
        <img src="{{ $resized.RelPermalink }}" 
             alt="{{ $book.title | plainify }}" 
             class="rounded-lg shadow-lg max-w-full h-auto object-contain" 
             style="max-height:450px; width:auto;">

        <!-- Bottom overlay with sample links -->
        <div class="absolute bottom-0 inset-x-0 bg-black bg-opacity-60 text-white p-2 flex justify-between items-center rounded-b-lg text-sm">
          <a href="{{ $book.sample_ebook_url }}" class="hover:underline">Read Sample</a>
          <a href="{{ $book.sample_audiobook_url }}" class="flex items-center gap-1 hover:underline">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-headphones" viewBox="0 0 16 16">
  <path d="M8 3a5 5 0 0 0-5 5v1h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V8a6 6 0 1 1 12 0v5a1 1 0 0 1-1 1h-1a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1V8a5 5 0 0 0-5-5"/>
</svg>
            Preview
          </a>
        </div>
      </div>
      {{ end }}
    </div>

  </div>
  {{ end }}
</section>
