{{- /* Tailwind Tag Cloud Shortcode */ -}}
{{ $taxonomy := .Get "taxonomy" | default "tags" }}
{{ $fontSmall := .Get "font_size_min" | default 0.8 }}
{{ $fontBig := .Get "font_size_max" | default 2.5 }}
{{ $itemsCountParam := .Get "count" | default 20 }}
{{ $columns := .Get "columns" | default "1" }}
{{ $text := .Get "text" }}

{{ $itemsCount := $itemsCountParam }}
{{ if eq $itemsCountParam 0 }}
  {{ $itemsCount = 65535 }}
{{ end }}

{{ $tags := slice }}
{{ if isset site.Taxonomies $taxonomy }}
  {{ $tags = first $itemsCount (index site.Taxonomies $taxonomy).ByCount }}
{{ end }}
{{ $count := len $tags }}

<div class="w-full {{ if eq $columns "2" }}lg:w-2/3{{ else }}text-center{{ end }}">
  {{ if $text }}
    <div class="mb-6 text-lg text-gray-600 dark:text-gray-400">{{ $text | markdownify | emojify }}</div>
  {{ end }}

  {{ if ne $count 0 }}
    {{ $fontDelta := sub $fontBig $fontSmall }}
    {{ $max := add (len (index $tags 0).Pages) 1 }}
    {{ $min := len (index ($tags).Reverse 0).Pages }}
    {{ $delta := sub $max $min }}
    {{ $fontStep := div $fontDelta $delta }}

    <div class="flex flex-wrap gap-2 justify-center items-center leading-relaxed">
      {{ range $name, $term := (sort $tags ".Page.Title" "asc") }}
        {{ $tagCount := len $term.Pages }}
        {{ $weight := div (sub (math.Log $tagCount) (math.Log $min)) (sub (math.Log $max) (math.Log $min)) }}
        {{ $fontSize := add $fontSmall (mul (sub $fontBig $fontSmall) $weight) }}

        {{ $sizeClass := "text-base" }}
        {{ if lt $fontSize 1.0 }}
          {{ $sizeClass = "text-sm" }}
        {{ else if lt $fontSize 1.25 }}
          {{ $sizeClass = "text-base" }}
        {{ else if lt $fontSize 1.5 }}
          {{ $sizeClass = "text-lg" }}
        {{ else if lt $fontSize 1.875 }}
          {{ $sizeClass = "text-xl" }}
        {{ else if lt $fontSize 2.25 }}
          {{ $sizeClass = "text-2xl" }}
        {{ else }}
          {{ $sizeClass = "text-3xl" }}
        {{ end }}

        <a href="{{ $term.Page.RelPermalink }}"
           class="{{ $sizeClass }} text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 transition-colors duration-200 hover:underline"
           title="{{ $tagCount }} {{ if eq $tagCount 1 }}post{{ else }}posts{{ end }}">
          {{ $term.Page.Title }}
        </a>
      {{ end }}
    </div>
  {{ else }}
    <div class="text-center text-gray-500 dark:text-gray-400">
      <p>No {{ $taxonomy }} found.</p>
    </div>
  {{ end }}
</div>{{- "" -}}
