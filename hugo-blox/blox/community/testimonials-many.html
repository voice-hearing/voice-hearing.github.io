{{/* Hugo Blox: Testimonial */}}
{{/* Documentation: https://hugoblox.com/blocks/ */}}
{{/* License: https://github.com/HugoBlox/hugo-blox-builder/blob/main/LICENSE.md */}}

{{/* Initialise */}}
{{ $page := .wcPage }}
{{ $block := .wcBlock }}
{{ $title := $block.content.title | emojify | $page.RenderString }}
{{ $text := $block.content.text | emojify | $page.RenderString }}
{{ $blue := $block.content.blue | emojify | $page.RenderString }}

{{/* Get customizable values with defaults */}}
{{ $stars := $block.content.stars | default 5 }}
{{ $rating := $block.content.rating | default "5.0" }}
{{ $reviews := $block.content.reviews | default "10,000+" }}

<section>
  <div class="mx-auto max-w-screen-xl px-8 py-12">
    
    <!-- Trust Indicator Section -->
    <div class="text-center mb-12">
      {{ with $blue }}
      <p class="mb-4 text-lg text-center tracking-tight uppercase font-semibold text-primary-600 dark:text-primary-300">{{.}}</p>
      {{ end }}
      
      {{ with $title }}
      <h2 class="mb-6 text-3xl lg:text-4xl tracking-tight font-bold text-gray-900 dark:text-white">{{.}}</h2>
      {{ end }}
      
      <!-- Dynamic Star Rating -->
      <div class="flex items-center justify-center mb-4">
        {{ range seq $stars }}
        <svg class="w-6 h-6 text-yellow-400 fill-current" viewBox="0 0 24 24">
          <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
        </svg>
        {{ end }}
        <span class="ml-3 text-lg font-medium text-gray-700 dark:text-gray-300">{{ $rating }} â€¢ Based on {{ $reviews }} reviews</span>
      </div>
      
      <!-- Profile Images with Minimal 3px Overlap -->
      <div class="flex items-center justify-center mb-6">
        <div class="flex" style="gap: -3px;">
          {{ range $index, $item := first 5 $block.content.items }}
          {{ $image := resources.GetMatch (path.Join "media" .image) }}
          {{ if $image }}
            {{ $processedImage := $image.Resize "48x48" }}
            <div class="relative" {{ if gt $index 0 }}style="margin-left: -3px;"{{ end }}>
              {{ if .url }}
              <a href="{{ .url }}" class="block" {{ if .external }}target="_blank" rel="noopener"{{ end }}>
                <img class="w-12 h-12 rounded-full border-4 border-white dark:border-gray-800 shadow-lg hover:scale-110 transition-transform duration-200" 
                     src="{{ $processedImage.RelPermalink }}" 
                     alt="{{ .name | plainify }}"
                     title="{{ .name | plainify }}"
                     loading="lazy">
              </a>
              {{ else }}
              <img class="w-12 h-12 rounded-full border-4 border-white dark:border-gray-800 shadow-lg hover:scale-110 transition-transform duration-200" 
                   src="{{ $processedImage.RelPermalink }}" 
                   alt="{{ .name | plainify }}"
                   title="{{ .name | plainify }}"
                   loading="lazy">
              {{ end }}
            </div>
          {{ else }}
            <!-- Placeholder for missing image -->
            <div class="w-12 h-12 rounded-full border-4 border-white dark:border-gray-800 shadow-lg bg-gray-300 dark:bg-gray-600 flex items-center justify-center" {{ if gt $index 0 }}style="margin-left: -3px;"{{ end }}>
              <span class="text-xs text-gray-600 dark:text-gray-300">?</span>
            </div>
          {{ end }}
          {{ end }}
        </div>
      </div>
      
      {{ with $text }}
      <p class="text-lg text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">{{.}}</p>
      {{ end }}
    </div>
  </div>
</section>
