{{/* ---------------------------------------------------------
   Hugo Blox – Testimonial block (Tailwind version)
   Docs: https://hugoblox.com/blocks/
   --------------------------------------------------------- */}}

{{/* -------- Init data -------- */}}
{{ $page   := .wcPage }}
{{ $block  := .wcBlock }}

{{ $title  := $block.content.title | emojify | $page.RenderString }}
{{ $text   := $block.content.text  | emojify | $page.RenderString }}
{{ $blue   := $block.content.blue  | emojify | $page.RenderString }}

{{/* rating & reviews */}}
{{ $ratingRaw := $block.content.rating  | default "4.5" }}
{{ $rating    := float $ratingRaw }}          {{/* 4.5 -> 4.5 */}}
{{ $intPart   := int   $rating }}             {{/* 4   -> full stars */}}
{{ $fraction  := sub  $rating (float $intPart) }}
{{ $hasHalf   := ge   $fraction 0.5 }}        {{/* true if ≥0.5 */}}
{{ $reviews   := $block.content.reviews | default "10,000+" }}

<section>
  <div class="mx-auto max-w-7xl px-8 py-8">           

    <!--------------- Header copy --------------->
  {{ with $blue }}
  <p class="mb-2 text-lg md:text-xl tracking-tight uppercase font-semibold text-primary-600 dark:text-primary-300">{{.}}</p>
  {{ end }}      
    <div class="w-16 border-2 border-primary-500 mb-4 justify mx-auto"></div>
  {{ with $title }}
  <h2 class="mb-4 text-3xl font-bold dark:font-semibold text-center text-gray-900 dark:text-white">{{.}}</h2>
  {{ end }}
      <!----------- Dynamic stars ----------->
      <div class="flex items-center justify-center mb-4">
        {{/* full stars */}}
        {{ range seq $intPart }}
          <svg class="w-5 h-5 text-yellow-400 fill-current" viewBox="0 0 24 24">
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
          </svg>
        {{ end }}

        {{/* optional half star */}}
        {{ if $hasHalf }}
          <svg class="w-5 h-5 text-yellow-400 fill-current" viewBox="0 0 24 24">
            <defs>
              <linearGradient id="half">
                <stop offset="50%" stop-color="currentColor"/>
                <stop offset="50%" stop-color="transparent"/>
              </linearGradient>
            </defs>
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"
                  fill="url(#half)"/>
          </svg>
        {{ end }}

        <span class="ml-2 text-sm font-medium text-gray-700 dark:text-gray-300">
          {{ printf "%.1f" $rating }} • Based on {{ $reviews }} reviews
        </span>
      </div>

      <!----------- Avatar stack (50 % overlap) ----------->
      <div class="flex justify-center mb-6">
        {{ range $idx, $item := first 5 $block.content.items }}
          {{ $img := resources.GetMatch (path.Join "media" $item.image) }}
          {{ with $img }}
            {{ $thumb := .Resize "64x64" }}
            <div class="{{ if gt $idx 0 }}-ml-3{{ end }}">
              {{ if $item.url }}
                <a href="{{ $item.url }}" {{ if $item.external }}target="_blank" rel="noopener"{{ end }}>
                  <img src="{{ $thumb.RelPermalink }}" alt="{{ $item.name | plainify }}"
                       class="w-16 h-16 rounded-full border-4 border-white
                              shadow-md hover:scale-110 transition-transform duration-200"
                       loading="lazy">
                </a>
              {{ else }}
                <img src="{{ $thumb.RelPermalink }}" alt="{{ $item.name | plainify }}"
                     class="w-16 h-16 rounded-full border-4 border-white
                            shadow-md hover:scale-110 transition-transform duration-200"
                     loading="lazy">
              {{ end }}
            </div>
          {{ end }}
        {{ end }}
      </div>

      {{ with $text }}
      <p class="text-gray-500 text-2xl dark:text-gray-400 text-center mb-12 px-4 lg:px-8">{{.}}</p>
      {{ end }}

  </div>
</section>
