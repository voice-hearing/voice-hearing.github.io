{{/* Hugo Blox: Features */}}
{{/* Documentation: https://hugoblox.com/blocks/ */}}
{{/* License: https://github.com/HugoBlox/hugo-blox-builder/blob/main/LICENSE.md */}}

{{/* Initialise */}}
{{ $page := .wcPage }}
{{ $block := .wcBlock }}
{{ $title := $block.content.title | emojify | $page.RenderString }}
{{ $text := $block.content.text | emojify | $page.RenderString }}
{{ $blue := $block.content.blue | emojify | $page.RenderString }}

<section class="mx-auto max-w-screen-7xl py-8 px-8">
    
    <!-- Header Section -->
    <div class="mb-12 flex flex-col justify-center mx-auto px-8 px-4 md:px-8">
      {{ with $blue }}
      <p class="mb-4 text-xl text-center tracking-tight uppercase font-semibold text-primary-600 dark:text-primary-300">{{.}}</p>
      {{ end }}      
      {{ with $title }}
      <h2 class="mb-4 text-4xl tracking-tight font-extrabold text-gray-900 dark:text-white text-center">{{.}}</h2>
      {{ end }}
      {{ with $text }}
      <p class="text-gray-500 text-2xl dark:text-gray-400 text-center">{{.}}</p>
      {{ end }}
    </div>
  
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 px-4 md:px-0">
      
      {{ range $index, $item := $block.content.slides }}
      
      <div class="relative overflow-hidden group shadow-xl -mx-8 md:-mx-4 lg:-mx-2.5 rounded-none md:rounded-lg">
        
        <!-- Background Image Processing -->
        {{ $bg := $item.background }}
        {{ $bg_img := "" }}
        
        {{ if $bg.image.filename }}
          {{ $bg_img = resources.Get (printf "media/%s" $bg.image.filename) }}
          {{ if $bg_img }}
            {{ $bg_img = $bg_img.Fit "600x600 q70 webp" }}
          {{ end }}
        {{ end }}
        
        <!-- Full-Screen Image Container -->
        {{ if $bg_img }}
        <img src="{{ $bg_img.RelPermalink }}" 
             alt="{{ $item.title | plainify }}" 
             class="w-full h-96 object-cover transition-all filter brightness-100 border-2 border-gray-200 dark:border-gray-600 md:border-0">
        {{ else }}
        <div class="w-full h-96 bg-gray-400 filter brightness-100 border-2 border-gray-200 dark:border-gray-600 md:border-0"></div>
        {{ end }}
        
        <!-- Gradient Overlay -->
        <a href="{{.url}}">
          <div class="absolute inset-0"></div>
        </a>
        
        <!-- Comprehensive Text Positioning System -->
        {{ $align := $item.align | default "bottom" }}
        {{ $text_bg_color := $item.text_bg_color | default "black/90" }}
        
        {{ if eq $align "center" }}
        <!-- CENTER: Perfect center alignment -->
        <div class="absolute inset-0 flex items-center justify-center px-6">
          <div class="bg-{{ $text_bg_color }} rounded-lg px-6 py-4 max-w-lg shadow-2xl text-center text-white backdrop-blur-sm">
        {{ else if eq $align "top" }}
        <!-- TOP CENTER: Top center alignment -->
        <div class="absolute left-0 right-0 top-0 pt-8 px-6 text-white text-center">
          <div class="bg-{{ $text_bg_color }} rounded-lg px-6 py-4 mx-auto inline-block max-w-sm shadow-2xl backdrop-blur-sm">
        {{ else if eq $align "bottom" }}
        <!-- BOTTOM CENTER: Bottom center alignment -->
        <div class="absolute left-0 right-0 bottom-0 pb-8 px-6 text-white text-center">
          <div class="bg-{{ $text_bg_color }} rounded-lg px-6 py-4 mx-auto inline-block max-w-sm shadow-2xl backdrop-blur-sm">
        {{ else if eq $align "top-left" }}
        <!-- TOP LEFT: Top left corner -->
        <div class="absolute top-0 left-0 pt-8 pl-8 text-white">
          <div class="bg-{{ $text_bg_color }} rounded-lg px-6 py-4 max-w-sm shadow-2xl backdrop-blur-sm">
        {{ else if eq $align "top-right" }}
        <!-- TOP RIGHT: Top right corner -->
        <div class="absolute top-0 right-0 pt-8 pr-8 text-white">
          <div class="bg-{{ $text_bg_color }} rounded-lg px-6 py-4 max-w-sm shadow-2xl text-right backdrop-blur-sm">
        {{ else if eq $align "center-left" }}
        <!-- CENTER LEFT: Middle left side -->
        <div class="absolute left-0 top-1/2 transform -translate-y-1/2 pl-8 text-white">
          <div class="bg-{{ $text_bg_color }} rounded-lg px-6 py-4 max-w-sm shadow-2xl backdrop-blur-sm">
        {{ else if eq $align "center-right" }}
        <!-- CENTER RIGHT: Middle right side -->
        <div class="absolute right-0 top-1/2 transform -translate-y-1/2 pr-8 text-white">
          <div class="bg-{{ $text_bg_color }} rounded-lg px-6 py-4 max-w-sm shadow-2xl text-right backdrop-blur-sm">
        {{ else if eq $align "bottom-left" }}
        <!-- BOTTOM LEFT: Bottom left corner -->
        <div class="absolute bottom-0 left-0 pb-8 pl-8 text-white">
          <div class="bg-{{ $text_bg_color }} rounded-lg px-6 py-4 max-w-sm shadow-2xl backdrop-blur-sm">
        {{ else if eq $align "bottom-right" }}
        <!-- BOTTOM RIGHT: Bottom right corner -->
        <div class="absolute bottom-0 right-0 pb-8 pr-8 text-white">
          <div class="bg-{{ $text_bg_color }} rounded-lg px-6 py-4 max-w-sm shadow-2xl text-right backdrop-blur-sm">
        {{ else }}
        <!-- DEFAULT: Bottom center if unknown alignment -->
        <div class="absolute left-0 right-0 bottom-0 pb-8 px-6 text-white text-center">
          <div class="bg-{{ $text_bg_color }} rounded-lg px-6 py-4 mx-auto inline-block max-w-sm shadow-2xl backdrop-blur-sm">
        {{ end }}
        
            <div class="space-y-3">
              <a href="{{.url}}" class="block">
                {{ with $item.title }}
                <h2 class="text-2xl md:text-3xl font-bold leading-tight drop-shadow-2xl text-white hover:text-gray-200 transition-colors duration-300">
                  {{ . | markdownify | emojify }}
                </h2>
                {{ end }}
              </a>
              
              {{ with $item.content }}
              <div class="text-sm md:text-base leading-relaxed text-gray-100 drop-shadow-lg">
                {{ . | emojify | $page.RenderString }}
              </div>
              {{ end }}
            </div>
          </div>
        </div>
        
      </div>
      
      {{ end }}
      
    </div>
  </div>
</section>
