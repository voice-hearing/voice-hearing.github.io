{{/* Hugo Blox: Enhanced CTA Image Paragraph - Clickable Images with Large Overlay Text */}}
{{/* Documentation: https://hugoblox.com/blocks/ */}}
{{/* License: https://github.com/HugoBlox/hugo-blox-builder/blob/main/LICENSE.md */}}

{{/* Initialise */}}
{{ $page := .wcPage }}
{{ $block := .wcBlock }}
{{ $title := $block.content.title | emojify | $page.RenderString }}
{{ $text := $block.content.text | emojify | $page.RenderString }}
{{ $blue := $block.content.blue | emojify | $page.RenderString }}

<style>
  /* All existing styles remain the same */
  .markdown-content a {
    color: rgb(185 28 28);
    text-decoration: underline;
    transition: opacity 0.2s ease-in-out;
  }
  
  .markdown-content a:hover {
    opacity: 0.8;
  }
  
  .dark .markdown-content a {
    color: rgb(253 164 175);
  }
  
  .content-text a {
    color: rgb(185 28 28);
    text-decoration: underline;
    font-weight: 500;
    transition: all 0.2s ease-in-out;
  }
  
  .content-text a:hover {
    opacity: 0.8;
  }
  
  .dark .content-text a {
    color: rgb(253 164 175);
  }
  
  .feature-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 2rem;
    height: 2rem;
    background-color: #16a34a;
    border-radius: 50%;
    color: #ffffff;
    flex-shrink: 0;
    margin-top: 0.25rem;
  }

  .feature-icon svg {
    width: 1.5em !important;
    height: 1.5em !important;
    fill: #ffffff !important;
    color: #ffffff !important;
    stroke: none !important;
    stroke-width: 0 !important;
  }

  .custom-icon-container {
    width: 1.5em;
    height: 1.5em;
    fill: #ffffff;
    color: #ffffff;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .custom-icon-container svg {
    width: 100% !important;
    height: 100% !important;
    fill: inherit !important;
    color: inherit !important;
    stroke: none !important;
    stroke-width: 0 !important;
  }

  .feature-row {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    margin-bottom: 2rem;
  }

  .feature-content {
    flex: 1;
    line-height: 1.4;
  }

  .feature-title {
    margin: 0;
    padding: 0;
    line-height: 1.3;
  }

  .overlay-bg-light {
    background-color: rgba(255, 255, 255, 0.9);
  }
  .overlay-bg-dark {
    background-color: rgba(0, 0, 0, 0.7);
  }

  .content-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 3rem;
    align-items: center;
  }

  @media (min-width: 768px) {
    .content-grid {
      grid-template-columns: 1fr 1fr;
      gap: 3rem;
    }
  }

  @media (min-width: 1024px) {
    .content-grid {
      gap: 4rem;
    }
  }

  /* CLICKABLE IMAGE LINK */
  .image-link {
    display: block;
    text-decoration: none;
    transition: transform 0.3s ease;
  }

  .image-link:hover {
    transform: scale(1.02);
  }

</style>

<div class="mx-auto max-w-7xl mt-0 px-1 md:px-4 lg:px-0 markdown-content">
  
  <!-- Header Section -->
  <div class="flex flex-col text-left">
    {{ with $blue }}
    <p class="mb-2 text-lg md:text-xl tracking-tight uppercase font-semibold text-primary-600 dark:text-primary-300">{{.}}</p>
    {{ end }}
  <div class="px-1 md:px-6 lg:px-0">
  <!-- Red horizontal line above title -->
  <div class="w-16 border-2 border-primary-700 mb-4 px-2"></div>
      
  {{ with $title }}
  <h2 class="mb-4 text-3xl font-bold text-gray-900 dark:text-white">{{.}}</h2>
  {{ end }}</div>
    
    {{ with $text }}
    <div class="text-xl text-gray-600 dark:text-gray-300 content-text">{{.}}</div>
    {{ end }}
  </div>

<div class="">
  {{ range $idx, $item := $block.content.items }}
  {{ $title := $item.title | emojify | $page.RenderString }}
  {{ $text := $item.text | emojify | $page.RenderString }}
  {{ $image_path := path.Join "media" $item.image }}
  {{ $image := resources.GetMatch $image_path }}
  {{ $layout := $item.layout | default "image-left" }}
  
  {{ with $image }}
  <div class="mx-auto max-w-screen-xl mb-0">
    <div class="content-grid">
      
      {{/* Content Section */}}
      <div class="{{ if eq $layout "text-left" }}order-1 md:order-1{{ else }}order-2 md:order-2{{ end }}">
        <h2 class="mb-6 tracking-tight font-bold text-gray-900 dark:text-white text-2xl">{{ $title }}</h2>
        <p class="mb-8 text-lg font-light text-gray-600 dark:text-gray-300 lg:text-xl">{{ $text }}</p>

        {{/* Features with Custom Icons */}}
        {{ with $item.features }}
        <div class="space-y-4">
          {{ range . }}
          <div class="feature-row">
            {{ $feature_icon := .icon | default "check-circle" }}
            
            <span class="feature-icon">
              {{ $custom_icon_path := printf "media/icons/custom/%s.svg" $feature_icon }}
              {{ $custom_icon := resources.Get $custom_icon_path }}
              {{ if $custom_icon }}
                <div class="custom-icon-container">
                  {{ $custom_icon.Content | safeHTML }}
                </div>
              {{ else }}
                {{ partial "functions/get_icon" (dict "name" $feature_icon "attributes" "style=\"width: 1.5em; height: 1.5em; fill: white; color: white; opacity: 1; visibility: visible;\"") }}
              {{ end }}
            </span>
            
            <div class="feature-content">
              <h3 class="feature-title text-2xl font-semibold text-gray-900 dark:text-white">
                {{ .name | default . | $page.RenderString }}
              </h3>
              {{ with .description }}
              <div class="text-gray-600 dark:text-gray-300 leading-relaxed mt-1">
                {{ . | $page.RenderString }}
              </div>
              {{ end }}
            </div>
          </div>
          {{ end }}
        </div>
        {{ end }}

        {{/* Skills Section */}}
        {{ with $item.skills }}
        <div class="space-y-4">
          {{ range . }}
          <div class="feature-row">
            {{ with .icon }}
            <span class="feature-icon">
              {{ $custom_icon_path := printf "media/icons/custom/%s.svg" . }}
              {{ $custom_icon := resources.Get $custom_icon_path }}
              {{ if $custom_icon }}
                <div class="custom-icon-container">
                  {{ $custom_icon.Content | safeHTML }}
                </div>
              {{ else }}
                {{ partial "functions/get_icon" (dict "name" . "attributes" "style=\"width: 1.5em; height: 1.5em; fill: #ffffff; stroke: none; stroke-width: 0;\"") }}
              {{ end }}
            </span>
            {{ end }}
            
            <div class="feature-content">
              <h3 class="feature-title text-xl font-semibold text-gray-900 dark:text-white">
                {{ .name | $page.RenderString }}
              </h3>
              {{ with .description }}
              <div class="text-gray-600 dark:text-gray-300 leading-relaxed mt-1">
                {{ . | $page.RenderString }}
              </div>
              {{ end }}
            </div>
          </div>
          {{ end }}
        </div>
        {{ end }}

        {{/* Button */}}
        {{ with $item.button }}
        <div class="mt-10">
          <a href="{{ .url }}" class="inline-flex items-center justify-center px-6 py-3 text-base font-medium text-white border border-primary-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 focus:ring-offset-gray-50 dark:focus:ring-offset-gray-900 transition-all duration-200" style="line-height: 1.2;">
            <span class="flex items-center">
              {{ .text }}
              <svg class="ml-2 w-4 h-4" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" style="margin-top: 1px; flex-shrink: 0;">
                <path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd"></path>
              </svg>
            </span>
          </a>
        </div>
        {{ end }}
      </div>

      {{/* Image Section with CLICKABLE IMAGE LINK */}}
      <div class="{{ if eq $layout "text-left" }}order-2 md:order-2{{ else }}order-1 md:order-1{{ end }} relative">
        {{ $image_url := $item.image_url | default "#" }}
        <a href="{{ $image_url }}" class="image-link">
          {{ if ne $image.MediaType.SubType "gif" }}
            {{ $responsive := partial "functions/process_responsive_image.html" (dict 
                "image" $image 
                "mode" "fill"
                "sizes" (slice 400 600 800 1200)
            ) }}
            <div class="aspect-square overflow-hidden rounded-2xl shadow-xl bg-white dark:bg-gray-800 relative group hover:shadow-2xl transition-shadow duration-300">
              <img class="w-full h-full object-cover" 
                   srcset="{{ $responsive.srcset }}"
                   sizes="(max-width: 768px) 100vw, 50vw"
                   src="{{ $responsive.fallback.RelPermalink }}" 
                   width="{{ $responsive.fallback.Width }}"
                   height="{{ $responsive.fallback.Width }}"
                   alt="{{ $title | plainify }}"
                   loading="lazy">
              
              {{/* NON-CLICKABLE LARGE OVERLAY TEXT */}}
              {{ with $item.overlay_text }}
              <div class="absolute bottom-0 left-0 overlay-bg-light dark:overlay-bg-dark rounded-lg"
                   style="padding: 1rem; margin: 1.5rem; pointer-events: none;">
                <h2 class="text-3xl font-bold text-gray-900 dark:text-white">
                  {{ . | $page.RenderString }}
                </h2>
              </div>
              {{ end }}
            </div>
          {{ else }}
            <div class="aspect-square overflow-hidden rounded-2xl shadow-xl bg-white dark:bg-gray-800 relative group hover:shadow-2xl transition-shadow duration-300">
              <img class="w-full h-full object-cover" 
                   src="{{ $image.RelPermalink }}" 
                   width="{{ $image.Width }}"
                   height="{{ $image.Width }}"
                   alt="{{ $title | plainify }}"
                   loading="lazy">
              
              {{/* NON-CLICKABLE LARGE OVERLAY TEXT */}}
              {{ with $item.overlay_text }}
              <div class="absolute bottom-0 left-0 overlay-bg-light dark:overlay-bg-dark rounded-lg"
                   style="padding: 1rem; margin: 1.5rem; pointer-events: none;">
                <h3 class="overlay-text-large text-gray-900 dark:text-white">
                  {{ . | $page.RenderString }}
                </h3>
              </div>
              {{ end }}
            </div>
          {{ end }}
        </a>
      </div>
      
    </div>
  </div>
  {{ else }}
    {{ errorf "%s uses the `cta-image-paragraph` blox which specifies a non-existent `image` at `assets/%s`. Please add the image to this folder and try again." $page.File.Path $image_path }}
  {{ end }}
  {{ end }}
</div>
</div>
